<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css" rel="stylesheet"/>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->

    <link rel="stylesheet" href="http://apps.bdimg.com/libs/jqueryui/1.10.4/css/jquery-ui.min.css">

    <!-- Font Awesome JS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css"
          integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">


    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
    <body>
        <button id="all_details">Choose address</button>
        <button id="add_new">Add a new address</button>

        <div id="details">

        </div>

        <div id="addNew" style="display: none">
            <form method="post">
                <input id="username" placeholder="Please input your username" required><br>
                <input id="phone" placeholder="Please input your phone number" required><br>
                <input id="address" placeholder="Please input your address" required><br>
                <button class="btn btn-primary btn-lg" type="button" id="add">Add</button>
            </form>
        </div>
    </body>

    <script>
        var detials = $("#details");
        fetch();
        $("#add_new").click(function () {
           detials.hide();
           $("#addNew").show();
        });

        $("#all_details").click(function () {
           detials.show();
           fetch();
           $("#addNew").hide();
        });

        /*
        detials.click(function () {
           $("#addNew").hide();
           detials.show();
        });
         */

        $("#add").click(function () {
           var username = $("#username");
           var phone = $("#phone");
           var address = $("#address");

           var u = "/api/receiver_detail/add_detail/" + "{{ current_user.phone_number }}" + "/" + username.val() + "/" + address.val() + "/" + phone.val();
           $.getJSON(u,function (data) {
               alert("Add details: " + data.message);
           });
        });

        function fetch() {
            url = "/api/receiver_detail/get_details/" + "{{ current_user.phone_number }}";
            detials.html("");
            $.getJSON(url, function (data) {
                    // console.log(data);
                    var html_conten = "";
                    // make the table headers
                    html_conten += "<div class=\"container\">";
                    html_conten += "<table class=\"table\" border=\"0\" style=\"border-collapse:collapse;\" cellspacing=\"0\" cellpadding=\"0\">\n" +
                        "        <tbody>";
                    html_conten += "<thead>\n" +
                            "            <th>Choose</th>\n" +
                        "            <th>Name</th>\n" +
                        "            <th>Phone</th>\n" +
                        "            <th>Adddress</th>\n" +
                        "        </thead>";


                    // make the details
                    for (var i = 0; i < data.details.length; i++) {
                        html_conten += "<tr>\n" +
                                "                <td><input type=\"radio\" name=\"radioname\" value=" + data.details[i].id +
                                "                   style=\"text-align: left;\">" +
                                "                <td>" + data.details[i].receiver_name + "</td>\n" +
                                "                <td>" + data.details[i].phone_number + "</td>\n" +
                                "                <td>" + data.details[i].receiver_address + " </td>\n" +
                                "            </tr>";
                    }

                    html_conten += "</tbody>\n" +
                        "    </table>";
                    html_conten += "</div>";
                    html_conten += "<button type=\"button\" class=\"btn btn-primary btn-lg\" id=\"pay\" onclick=\"checkPay()\" style=\"margin-left: 36%;margin-top: 0%\">Pay</button>";
                    html_conten += "<button type=\"button\" class=\"btn btn-primary btn-lg\" id=\"pay\" onclick=\"deleteAddress()\" style=\"margin-left: 36%;margin-top: 0%\">Delete</button>";

                    detials.append(html_conten);
            });
        }

        function checkPay() {
            // get the select id
            // var value = -1;
            var value = $("input:radio[name=\"radioname\"]:checked").val();

            // console.log(value);
            // return;
            if (value === undefined) {
                alert("Please at least choose a address!");
                return;
            }

            // console.log(value);
            var url = "/api/receiver_detail/set_detail/" + "{{ current_user.phone_number }}" + "/" + value;
            $.getJSON(url, function (data) {
                if (data.message === "success") {
                    window.location.assign("/pay");
                }
            });
        }

        function deleteAddress() {
            var value = $("input:radio[name=\"radioname\"]:checked").val();

            if (value === "") {
                alert("Please at least choose a address!");
                return;
            }

            var url = "/api/receiver_detail/delete_detail/" + value;
            $.getJSON(url, function (data) {
                if (data.message === "success") {
                    fetch();
                    alert("Delete success");
                }
            });
        }

    </script>


</html>